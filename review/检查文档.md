# 项目 Bug 检查文档（执行版）

## 1) 项目总体结构

本目录下实际是一个前后端分离项目：

- 前端：`Claude_clone/`
  - 技术栈：React + TypeScript + Vite
  - 关键目录：`src/components/`、`src/api.ts`、`src/adminApi.ts`
- 后端：`Claude_clone_backend/`
  - 技术栈：Node.js + Express + PostgreSQL（通过自定义 `db` 包装层）
  - 关键目录：`src/routes/`、`src/middleware/`、`src/lib/`、`src/tools/`

> 本次检查只做静态审查与只读验证，不改业务代码。

---

## 2) 检查目标

面向“几百个用户同时使用”的场景，重点排查：

1. 会导致服务不可用/大面积失败的问题（并发、异常处理、资源泄漏）
2. 认证鉴权与数据安全问题（权限绕过、敏感数据泄露、SSRF）
3. 计费/配额/会话相关逻辑错误
4. 前后端联动导致的卡死、状态不一致、长时间等待

---

## 3) 检查方法

- 结构梳理：目录与模块职责快速映射
- 后端静态审查：`index`、`routes`、`middleware`、`lib`、`tools`
- 前端静态审查：`App`、`MainContent`、`api`、`pyodideRunner`、`Sidebar`
- 只读验证命令：
  - `npm --prefix Claude_clone exec tsc -- --noEmit -p Claude_clone/tsconfig.json`（通过）
  - `find Claude_clone_backend/src -name "*.js" -print0 | xargs -0 -n1 node --check`（通过）

---

## 4) 分阶段检查清单（已执行）

- [x] A. 总体结构与运行入口检查（前后端入口、路由挂载、目录职责）
- [x] B. 认证与会话流程检查（登录/注册/重置密码/JWT/session）
- [x] C. 聊天主链路检查（并发控制、SSE、异常/中断/资源释放）
- [x] D. 上传与文件处理检查（配额、文件读写、返回字段）
- [x] E. 工具链安全检查（网页抓取、搜索、代码执行、文档生成）
- [x] F. 管理后台与支付兑换检查（权限、参数、事务）
- [x] G. 前端状态机检查（发送/停止/轮询/错误回调）
- [x] H. 编译与语法级验证（TS noEmit + Node syntax check）

---

## 5) 输出文档

已将发现的问题写入：

- `Claude_clone/review/问题清单.md`

该文档按严重级别列出问题、定位（文件+行号）、影响与修复建议。
